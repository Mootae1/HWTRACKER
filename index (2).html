<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Homework Tracker</title>
<style>
  * { box-sizing: border-box; font-family: "Inter", sans-serif; transition: all 0.25s ease; }
  :root {
    --bg: radial-gradient(circle at top left, #0f172a, #020617);
    --card-bg: rgba(255,255,255,0.08);
    --text: #e2e8f0;
    --accent: #7c3aed;
    --button-bg: linear-gradient(90deg, #7c3aed, #6366f1);
  }
  body.light {
    --bg: linear-gradient(180deg, #f9fafb, #e5e7eb);
    --card-bg: rgba(255,255,255,1);
    --text: #111827;
    --accent: #4338ca;
    --button-bg: linear-gradient(90deg, #4f46e5, #6366f1);
  }
  body {
    margin: 0; padding: 0;
    background: var(--bg); color: var(--text);
    display: flex; justify-content: center; align-items: flex-start;
    min-height: 100vh;
  }
  .container {
    width: 95%; max-width: 900px;
    margin-top: 40px; text-align: center;
    animation: fadeIn 1s ease forwards; position: relative;
  }
  .theme-toggle {
    position: absolute; top: -10px; right: 0;
    background: var(--card-bg); border: none; border-radius: 50%;
    width: 44px; height: 44px; cursor: pointer; font-size: 20px;
    color: var(--text); display: flex; justify-content: center; align-items: center;
    box-shadow: 0 0 10px rgba(0,0,0,0.4);
  }
  h1 { font-size: 2.3rem; color: var(--accent); font-weight: 700; margin-bottom: 8px; }
  p.subtitle { color: #94a3b8; margin-bottom: 25px; }
  form {
    background: var(--card-bg); border-radius: 16px;
    padding: 20px; display: flex; flex-direction: column; gap: 12px;
    margin-bottom: 20px;
  }
  input, select, textarea, button {
    padding: 12px; border-radius: 10px; border: none; font-size: 15px;
  }
  input, select, textarea {
    background: rgba(255,255,255,0.12); color: var(--text); outline: none;
  }
  textarea { resize: vertical; min-height: 60px; }
  input::placeholder, textarea::placeholder { color: #9ca3af; }
  button {
    background: var(--button-bg); color: white; font-weight: 600; cursor: pointer;
  }
  .filter {
    width: 100%; background: rgba(255,255,255,0.12); border-radius: 10px;
    color: var(--text); margin-bottom: 20px;
  }
  ul { list-style: none; padding: 0; }
  li {
    background: var(--card-bg); border-radius: 14px;
    padding: 16px; margin-bottom: 12px; display: flex; flex-direction: column; gap: 6px;
  }
  .subject { font-weight: 600; font-size: 1rem; }
  .details, .link { font-size: 0.9rem; }
  .link a { color: var(--accent); text-decoration: underline; word-break: break-word; }
  .deadline { font-size: 0.85rem; }
  .countdown { font-weight: 600; font-size: 0.85rem; }
  .status-green { color: #22c55e; }
  .status-yellow { color: #eab308; }
  .status-red { color: #ef4444; }
  .empty { color: #94a3b8; text-align: center; margin-top: 25px; }
</style>
</head>
<body>
<div class="container">
  <button class="theme-toggle" id="themeToggle">üåô</button>
  <h1>Homework Tracker</h1>
  <p class="subtitle">Stay organized, stay focused</p>

  <form id="taskForm">
    <input type="text" id="taskName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô" required>
    <select id="subject" required>
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
      <option>‡∏Ñ‡∏ì‡∏¥‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</option><option>‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</option>
      <option>‡∏™‡∏±‡∏á‡∏Ñ‡∏°</option><option>‡∏ä‡∏µ‡∏ß‡∏∞(‡∏ò‡∏ô‡∏≤‡∏ß‡∏∏‡∏ï)</option><option>‡∏ä‡∏µ‡∏ß‡∏∞(‡∏Ç‡∏ô‡∏¥‡∏©‡∏ê‡∏≤)</option>
      <option>‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå</option><option>‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option><option>‡πÄ‡∏Ñ‡∏°‡∏µ</option>
      <option>‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©(Elvin)</option><option>‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©(‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô)</option><option>‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©(‡∏≠‡∏≥‡∏ô‡∏≤‡∏à)</option>
      <option>‡∏ß‡∏¥‡∏®‡∏ß‡∏∞</option><option>‡πÅ‡∏û‡∏ó‡∏¢‡πå</option><option>‡πÄ‡∏†‡∏™‡∏±‡∏ä</option>
      <option>‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡πå</option><option>‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option><option>IS</option><option>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option><option>‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
    </select>
    <textarea id="details" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏ô‡πâ‡∏≤ 25‚Äì30 ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥)"></textarea>
    <input type="url" id="link" placeholder="‡πÅ‡∏ô‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏á‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô Google Docs ‡∏´‡∏£‡∏∑‡∏≠ Classroom)">
    <input type="datetime-local" id="deadline" required>
    <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</button>
  </form>

  <input id="filter" class="filter" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤...">
  <ul id="taskList"></ul>
  <p class="empty" id="emptyMsg">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ üéâ</p>
</div>

<script>
// === ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ===
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz3BjPHQAV7D5BfVkcq3JX3vKDim2KGiLVR_sETPhtuNs38M_G5A0mD6zn3gjo1cRzU/exec";
const SECRET_KEY = "MEI"; // üëà ‡πÉ‡∏™‡πà key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà

// === ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet ===
async function loadTasks() {
  const res = await fetch(SCRIPT_URL);
  const tasks = await res.json();
  return tasks.sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
}

// === ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á) ===
async function addTask(task) {
  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ ...task, key: SECRET_KEY }),
    headers: { "Content-Type": "application/json" },
  });
}

// === ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ===
async function render() {
  const list = document.getElementById('taskList');
  const filter = document.getElementById('filter').value.toLowerCase();
  list.innerHTML = '';
  const tasks = await loadTasks();
  let shown = 0;

  tasks.forEach(task => {
    if (filter && !task.subject.toLowerCase().includes(filter)) return;
    if (task.done === "TRUE") return;
    const diff = new Date(task.deadline) - new Date();
    const scls = diff <= 0 ? 'status-red' : diff <= 172800000 ? 'status-yellow' : 'status-green';
    const days = Math.floor(diff / (1000*60*60*24));
    const hrs = Math.floor((diff / (1000*60*60)) % 24);
    const min = Math.floor((diff / (1000*60)) % 60);

    const li = document.createElement('li');
    li.innerHTML = `
      <div class='subject'>${task.name} (${task.subject})</div>
      ${task.details ? `<div class='details'>üìò ${task.details}</div>` : ''}
      ${task.link ? `<div class='link'>üîó <a href='${task.link}' target='_blank'>${task.link}</a></div>` : ''}
      <div class='deadline'>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á: ${new Date(task.deadline).toLocaleString()}</div>
      <div class='countdown ${scls}'>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å: ${days} ‡∏ß‡∏±‡∏ô ${hrs} ‡∏ä‡∏°. ${min} ‡∏ô‡∏≤‡∏ó‡∏µ</div>
    `;
    list.appendChild(li);
    shown++;
  });

  document.getElementById('emptyMsg').style.display = shown ? 'none' : 'block';
}

// === ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° ===
document.getElementById('taskForm').onsubmit = async e => {
  e.preventDefault();
  const t = {
    name: taskName.value,
    subject: subject.value,
    details: details.value,
    link: link.value,
    deadline: deadline.value,
    done: false
  };
  await addTask(t);
  e.target.reset();
  alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
  render();
};

// === ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ===
document.getElementById('filter').oninput = render;

// === ‡∏ò‡∏µ‡∏° ===
const btn = document.getElementById('themeToggle');
if (localStorage.getItem('theme') === 'light') {
  document.body.classList.add('light');
  btn.textContent = '‚òÄÔ∏è';
}
btn.onclick = () => {
  document.body.classList.toggle('light');
  const light = document.body.classList.contains('light');
  btn.textContent = light ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('theme', light ? 'light' : 'dark');
};

// === ‡πÄ‡∏£‡∏¥‡πà‡∏° ===
render();
setInterval(render, 60000);
</script>
</body>
</html>
